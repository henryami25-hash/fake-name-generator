<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel ‚Ä¢ Fake Name Generator</title>

  <!-- Firebase CDN (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    :root{
      --bg1:#0b1220; --bg2:#0a2a5a;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text:#eaf0ff;
      --muted: rgba(255,255,255,.75);
      --btn:#2b6cff;
      --btn2: rgba(255,255,255,.10);
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 18px;
      --ok:#57ffa6;
      --bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: radial-gradient(1200px 700px at 20% 10%, #173b8f 0%, rgba(23,59,143,0) 55%),
                  radial-gradient(900px 600px at 80% 30%, #0bb3ff33 0%, rgba(11,179,255,0) 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    .wrap{width:min(920px,100%)}
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .top{
      padding:16px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .title{font-weight:900; letter-spacing:.3px}
    .sub{font-size:12px; color:var(--muted); margin-top:3px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text); text-decoration:none;
      font-size:13px;
    }
    .content{padding:16px 18px 18px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width:820px){ .grid{grid-template-columns:1fr} }
    .box{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      border-radius:16px;
      padding:14px;
    }
    h3{margin:0 0 10px; font-size:15px}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    textarea{min-height:120px; resize:vertical; line-height:1.45}
    .row{display:flex; gap:10px}
    .row > *{flex:1}
    .btn{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:0;
      background: var(--btn);
      color:white;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(43,108,255,.25);
      margin-top:10px;
    }
    .btn2{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: var(--btn2);
      color: var(--text);
      font-weight:800;
      cursor:pointer;
      margin-top:10px;
    }
    .hint{font-size:12px; color:rgba(255,255,255,.72); line-height:1.5}
    .status{margin-top:10px; font-size:13px; min-height:18px}
    .ok{color:var(--ok)}
    .bad{color:var(--bad)}
    .hide{display:none !important}
    .divider{height:1px; background:rgba(255,255,255,.10); margin:12px 0}
    .toggle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      margin-top:10px;
    }
    .toggle span{font-weight:800}
    .toggle small{display:block; font-size:12px; color:rgba(255,255,255,.7); font-weight:600; margin-top:2px}
    .toggle input{width:22px; height:22px}
    .toast{
      position:fixed; left:50%; bottom:18px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.16);
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:.25s;
      z-index:9999;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="top">
      <div>
        <div class="title">Admin Panel</div>
        <div class="sub">Fake Name Generator ‚Ä¢ Firebase Auth + Firestore</div>
      </div>
      <a class="pill" href="./index.html" target="_blank" rel="noopener">Open User Panel</a>
    </div>

    <div class="content">

      <!-- LOGIN -->
      <div class="box" id="loginBox">
        <h3>üîê Admin Login</h3>
        <div class="hint">Email/Password ‡¶¶‡¶ø‡ßü‡ßá login ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ (Firebase Authentication ‚Üí Email/Password enabled ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá)</div>

        <label>Email</label>
        <input id="email" type="email" placeholder="admin@email.com" autocomplete="username">

        <label>Password</label>
        <input id="pass" type="password" placeholder="********" autocomplete="current-password">

        <button class="btn" id="loginBtn">Login</button>
        <div class="status" id="loginStatus"></div>
      </div>

      <!-- PANEL -->
      <div class="grid hide" id="panelBox">

        <!-- Names Manager -->
        <div class="box">
          <h3>üßæ Names Manager (Dedupe + Merge)</h3>

          <div class="row">
            <div>
              <label>Country</label>
              <input id="country" placeholder="Bangladesh / USA / India ...">
            </div>
            <div>
              <label>Gender</label>
              <select id="gender">
                <option value="male">male</option>
                <option value="female">female</option>
              </select>
            </div>
          </div>

          <label>Names (‡¶è‡¶ï ‡¶≤‡¶æ‡¶á‡¶® = ‡¶è‡¶ï ‡¶®‡¶æ‡¶Æ)</label>
          <textarea id="names" placeholder="Rahim Ahmed&#10;Karim Khan&#10;..."></textarea>

          <button class="btn" id="saveNamesBtn">Save Names (merge + remove duplicates)</button>
          <button class="btn2" id="loadCountBtn">Check Existing Count</button>

          <div class="status" id="namesStatus"></div>
          <div class="divider"></div>
          <div class="hint">
            ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ + ‡¶Ü‡¶ó‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá dedupe ‡¶π‡¶¨‡ßá‡•§<br>
            ‚úÖ ‡¶è‡¶ï‡¶á ‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶≤‡ßá duplicate add ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§<br>
            ‚úÖ (Advanced) ‡¶Ü‡¶ó‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶ï‡¶á country+gender ‡¶è ‡¶Ö‡¶®‡ßá‡¶ï doc ‡¶•‡¶æ‡¶ï‡ßá, ‡¶∏‡¶¨ merge ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï doc ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶¨‡ßá‡•§
          </div>
        </div>
<div class="divider"></div>

<h3>üóëÔ∏è Delete Names (Country + Gender)</h3>

<label>Delete Type</label>
<select id="deleteType">
  <option value="names">Only Names Array Clear</option>
  <option value="doc">Delete Full Document</option>
</select>

<button class="btn2" id="deleteNamesBtn">
  Delete Selected Country + Gender
</button>

<div class="status" id="deleteStatus"></div>

<div class="hint">
‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ:<br>
‚Ä¢ Only Names = names[] ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶π‡¶¨‡ßá (doc ‡¶•‡¶æ‡¶ï‡¶¨‡ßá)<br>
‚Ä¢ Full Document = country+gender ‡¶è‡¶∞ ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ delete ‡¶π‡¶¨‡ßá
</div>
        <!-- Notice + Telegram -->
        <div class="box">
          <h3>üì¢ Live Notice + Telegram CTA</h3>

          <div class="toggle">
            <div>
              <span>Notice Active</span>
              <small>User panel-‡¶è notice show/hide</small>
            </div>
            <input type="checkbox" id="noticeActive">
          </div>

          <label>Notice Text</label>
          <input id="noticeText" placeholder="‡¶Ü‡¶ú ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü...">

          <div class="toggle">
            <div>
              <span>Notice Telegram Link</span>
              <small>Notice bar-‡¶è Join Telegram link show/hide</small>
            </div>
            <input type="checkbox" id="noticeShowTelegramLink">
          </div>

          <div class="divider"></div>

          <div class="toggle">
            <div>
              <span>Telegram CTA Button</span>
              <small>Top Telegram button show/hide</small>
            </div>
            <input type="checkbox" id="telegramCtaEnabled">
          </div>

          <label>Telegram Link</label>
          <input id="tgLink" placeholder="https://t.me/your_channel">

          <label>Telegram Button Text</label>
          <input id="telegramCtaText" placeholder="Telegram">

          <button class="btn" id="saveNoticeBtn">Save Notice & Telegram</button>
          <div class="status" id="noticeStatus"></div>
        </div>

        <!-- Ads + AdFree -->
        <div class="box">
          <h3>üí∞ Ads + Ad-Free Controls</h3>

          <div class="toggle">
            <div>
              <span>Ads Master</span>
              <small>adsEnabled (‡¶∏‡¶¨ ads on/off)</small>
            </div>
            <input type="checkbox" id="adsEnabled">
          </div>

          <div class="toggle">
            <div>
              <span>Interstitial</span>
              <small>interstitialEnabled (generate interval ads)</small>
            </div>
            <input type="checkbox" id="interstitialEnabled">
          </div>

          <div class="toggle">
            <div>
              <span>Ad-Free Button</span>
              <small>‚ÄúWatch 10 Ads ‚Üí 24h Ad-Free‚Äù button show/hide</small>
            </div>
            <input type="checkbox" id="adFreeOptionEnabled">
          </div>

          <div class="toggle">
            <div>
              <span>Ad-Free Status Text</span>
              <small>‚ÄúWatch X more‚Ä¶‚Äù / ‚ÄúAd-free active‚Ä¶‚Äù text show/hide</small>
            </div>
            <input type="checkbox" id="adFreeStatusEnabled">
          </div>

          <button class="btn" id="saveAdsBtn">Save Ads Settings</button>
          <div class="status" id="adsStatus"></div>

          <div class="divider"></div>
          <button class="btn2" id="logoutBtn">Logout</button>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ========= Firebase Config (same as user panel) ========= */
const firebaseConfig = {
  apiKey: "AIzaSyCZ08SgQo36dVouHYVatQjOPBjR7FBuiTM",
  authDomain: "fake-name-generator-445ef.firebaseapp.com",
  projectId: "fake-name-generator-445ef",
  storageBucket: "fake-name-generator-445ef.appspot.com",
  messagingSenderId: "173185143834",
  appId: "1:173185143834:web:e39cfc5ca34abfc458eda3"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
// üîí FORCE LOGIN EVERY TIME (disable auto-login)
auth.signOut().catch(()=>{});

const $ = (id)=>document.getElementById(id);

function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=>t.classList.remove("show"), 1600);
}
function setStatus(el, msg, ok=true){
  el.textContent = msg;
  el.className = "status " + (ok ? "ok" : "bad");
}
function normName(s){
  return String(s || "")
    .replace(/\s+/g," ")
    .trim();
}
function keyCountryGender(country, gender){
  // doc id: country__gender
  return `${country}__${gender}`;
}

/* ========= Auth UI ========= */
$("loginBtn").addEventListener("click", async ()=>{
  const email = $("email").value.trim();
  const pass = $("pass").value;
  if(!email || !pass){
    setStatus($("loginStatus"), "Email/Password ‡¶¶‡¶ø‡¶®‡•§", false);
    return;
  }
  try{
    await auth.signInWithEmailAndPassword(email, pass);
    setStatus($("loginStatus"), "Login success ‚úÖ");
  }catch(e){
    setStatus($("loginStatus"), "Login failed: " + (e.message || e), false);
  }
});

$("logoutBtn").addEventListener("click", async ()=>{
  await auth.signOut();
  toast("Logged out");
});

auth.onAuthStateChanged(async (u)=>{
  if(u){
    $("loginBox").classList.add("hide");
    $("panelBox").classList.remove("hide");
    await loadSettingsToUI();
    toast("Welcome admin ‚úÖ");
  }else{
    $("panelBox").classList.add("hide");
    $("loginBox").classList.remove("hide");
  }
});

/* ========= Load settings to UI ========= */
async function loadSettingsToUI(){
  // Notice
  const nDoc = await db.collection("settings").doc("notice").get();
  const nd = nDoc.exists ? (nDoc.data()||{}) : {};
  $("noticeActive").checked = !!nd.noticeActive;
  $("noticeText").value = (nd.noticeText || "");
  $("noticeShowTelegramLink").checked = nd.noticeShowTelegramLink !== false;
  $("telegramCtaEnabled").checked = nd.telegramCtaEnabled !== false;
  $("tgLink").value = (nd.tgLink || "");
  $("telegramCtaText").value = (nd.telegramCtaText || "Telegram");

  // Ads
  const aDoc = await db.collection("settings").doc("ads").get();
  const ad = aDoc.exists ? (aDoc.data()||{}) : {};
  $("adsEnabled").checked = ad.adsEnabled !== false;
  $("interstitialEnabled").checked = ad.interstitialEnabled !== false;
  $("adFreeOptionEnabled").checked = ad.adFreeOptionEnabled !== false;
  $("adFreeStatusEnabled").checked = ad.adFreeStatusEnabled !== false;
}

/* ========= Save Notice + Telegram ========= */
$("saveNoticeBtn").addEventListener("click", async ()=>{
  try{
    const payload = {
      noticeActive: $("noticeActive").checked,
      noticeText: $("noticeText").value.trim(),
      noticeShowTelegramLink: $("noticeShowTelegramLink").checked,

      telegramCtaEnabled: $("telegramCtaEnabled").checked,
      tgLink: $("tgLink").value.trim(),
      telegramCtaText: $("telegramCtaText").value.trim() || "Telegram"
    };
    await db.collection("settings").doc("notice").set(payload, {merge:true});
    setStatus($("noticeStatus"), "Saved ‚úÖ");
    toast("Notice & Telegram saved");
  }catch(e){
    setStatus($("noticeStatus"), "Save failed: " + (e.message||e), false);
  }
});

/* ========= Save Ads ========= */
$("saveAdsBtn").addEventListener("click", async ()=>{
  try{
    const payload = {
      adsEnabled: $("adsEnabled").checked,
      interstitialEnabled: $("interstitialEnabled").checked,
      adFreeOptionEnabled: $("adFreeOptionEnabled").checked,
      adFreeStatusEnabled: $("adFreeStatusEnabled").checked
    };
    await db.collection("settings").doc("ads").set(payload, {merge:true});
    setStatus($("adsStatus"), "Saved ‚úÖ");
    toast("Ads settings saved");
  }catch(e){
    setStatus($("adsStatus"), "Save failed: " + (e.message||e), false);
  }
});

/* ========= Existing Count ========= */
$("loadCountBtn").addEventListener("click", async ()=>{
  const country = $("country").value.trim();
  const gender = $("gender").value;
  if(!country){
    setStatus($("namesStatus"), "Country ‡¶¶‡¶ø‡¶®‡•§", false);
    return;
  }

  try{
    const snap = await db.collection("names")
      .where("country","==",country)
      .where("gender","==",gender)
      .get();

    let total = 0;
    snap.forEach(doc=>{
      const d = doc.data()||{};
      if(Array.isArray(d.names)) total += d.names.length;
    });

    setStatus($("namesStatus"), `Existing docs: ${snap.size} ‚Ä¢ Total names (raw): ${total}`);
  }catch(e){
    setStatus($("namesStatus"), "Load failed: " + (e.message||e), false);
  }
});

/* ========= Save Names (merge + remove duplicates) ========= */
$("saveNamesBtn").addEventListener("click", async ()=>{
  const country = $("country").value.trim();
  const gender = $("gender").value;
  const raw = $("names").value;

  if(!country){
    setStatus($("namesStatus"), "Country ‡¶¶‡¶ø‡¶®‡•§", false);
    return;
  }
  const lines = raw.split(/\r?\n/).map(normName).filter(Boolean);
  if(!lines.length){
    setStatus($("namesStatus"), "Names list ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§", false);
    return;
  }

  try{
    // 1) read ALL existing docs for that country+gender
    const snap = await db.collection("names")
      .where("country","==",country)
      .where("gender","==",gender)
      .get();

    // 2) build dedupe set (case-insensitive)
    const set = new Map(); // keyLower => originalName (first seen)
    snap.forEach(doc=>{
      const d = doc.data()||{};
      const arr = Array.isArray(d.names) ? d.names : [];
      for(const n of arr){
        const nn = normName(n);
        if(!nn) continue;
        const k = nn.toLowerCase();
        if(!set.has(k)) set.set(k, nn);
      }
    });

    const beforeUnique = set.size;

    // 3) add new lines, dedupe again
    let added = 0;
    for(const n of lines){
      const k = n.toLowerCase();
      if(!set.has(k)){
        set.set(k, n);
        added++;
      }
    }

    const merged = Array.from(set.values());

    // 4) write to ONE canonical doc id, delete other docs (cleanup)
    const canonicalId = keyCountryGender(country, gender);
    const batch = db.batch();

    // delete other docs (optional but good for clean)
    snap.forEach(doc=>{
      if(doc.id !== canonicalId){
        batch.delete(doc.ref);
      }
    });

    // set canonical doc
    const ref = db.collection("names").doc(canonicalId);
    batch.set(ref, {
      country,
      gender,
      names: merged,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    }, {merge:true});

    await batch.commit();

    setStatus(
      $("namesStatus"),
      `Saved ‚úÖ Unique before: ${beforeUnique} ‚Ä¢ Added new unique: ${added} ‚Ä¢ Final unique: ${merged.length} ‚Ä¢ Cleaned docs: ${Math.max(0, snap.size - 1)}`
    );
    toast("Names saved (dedupe done)");
    $("names").value = "";
  }catch(e){
    setStatus($("namesStatus"), "Save failed: " + (e.message||e), false);
  }
});
/* ========= Delete Names / Doc ========= */
$("deleteNamesBtn").addEventListener("click", async ()=>{
  const country = $("country").value.trim();
  const gender = $("gender").value;
  const type = $("deleteType").value;

  if(!country){
    setStatus($("deleteStatus"), "Country ‡¶¶‡¶ø‡¶®‡•§", false);
    return;
  }

  if(!confirm(`Are you sure?\nCountry: ${country}\nGender: ${gender}`)){
    return;
  }

  try{
    const snap = await db.collection("names")
      .where("country","==",country)
      .where("gender","==",gender)
      .get();

    if(snap.empty){
      setStatus($("deleteStatus"), "No data found.", false);
      return;
    }

    const batch = db.batch();

    snap.forEach(doc=>{
      if(type === "doc"){
        // üî• Full document delete
        batch.delete(doc.ref);
      }else{
        // üßπ Only names array clear
        batch.update(doc.ref, {
          names: [],
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    });

    await batch.commit();

    setStatus(
      $("deleteStatus"),
      type === "doc"
        ? "‚úÖ Full document deleted successfully"
        : "‚úÖ Names array cleared successfully"
    );
    toast("Delete operation completed");

  }catch(e){
    setStatus($("deleteStatus"), "Delete failed: " + (e.message||e), false);
  }
});
</script>
</body>
</html>